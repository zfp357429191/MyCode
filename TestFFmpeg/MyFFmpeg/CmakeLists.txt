cmake_minimum_required(VERSION 3.16)

# 项目名
project(MyFFmpeg)

# 关闭VS中SAFESEH映象编译问题
set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} /SAFESEH:NO")
set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} /SAFESEH:NO")
set(CMAKE_MODULE_LINKER_FLAGS "${CMAKE_MODULE_LINKER_FLAGS} /SAFESEH:NO")


# 引用第三方库头文件
include_directories(${DepsPath}/123/456/../../include)

# 编译源文件
add_executable(${PROJECT_NAME} main.cpp MyFFmpeg.cpp MyFFmpeg.hpp)

# 链接库文件
target_link_libraries(${PROJECT_NAME}
                    ${DepsPath}/lib/win32/avcodec.lib
                    ${DepsPath}/lib/win32/avformat.lib
                    ${DepsPath}/lib/win32/avutil.lib
                    ${DepsPath}/lib/win32/swscale.lib
                    ${DepsPath}/lib/win32/swresample.lib
                    )


# 拷贝依赖库文件
file (GLOB FFmpegDlls ${DepsPath}/bin/win32/*.dll)
foreach(FFmpegDll ${FFmpegDlls})
    add_custom_command(TARGET MyFFmpeg POST_BUILD
            COMMAND "${CMAKE_COMMAND}" -E copy   
            ${FFmpegDll}
            ${CMAKE_BINARY_DIR}/${target}$<$<CONFIG:Debug>:Debug>${target}$<$<CONFIG:Release>:Release>/
            )
endforeach()

